<!--

This file serves as our password creation and entry page

List of functions and what they do:
===================================

clearShapes() - this clears all the shapes in the input box

rect(s,ctx,fillStyle) - this will output the specific shaped inputted as s, with the corresponding ctx canvas and give it a specific color through fillstyle

drawStar(cx,cy,spikes,outerRadius,innerRadius,ctx,fillStyle) - this is a specific function used for the creation of start shapes that also has the addition ctx and fillstyles for the respective canvas and color

clear(ctx) - this clears one specific shape at the specified canvas

getUrlParameter(sParam) - this gets the url parameter and is used to determine which account is currently being processed

createPassword() - this calls the creation password algorithm which randomly selects a position in the array and gets the corresponding binary strings

enterPassword(type) - this is used as a checker for whether the inputted password matches the created password for testing or the password created in the creation step for the entry step

togPassword() - this shows or hides the password for blind testing/practice

acceptPassword() - this accepts the password inputted  in the creation step

-->


<!doctype html>
<head>
	<script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>


	<style>
		canvas{border:1px solid black;}

		input .color {
		  position: absolute;
		  opacity: 0;
		  cursor: pointer;
		  height: 0;
		  width: 0;
		}

		.checkmark {
		  position: absolute;
		  top: 0;
		  left: 0;
		  height: 25px;
		  width: 25px;
		  background-color: #eee;
		}

		.checkmark:after {
		  content: "";
		  position: absolute;
		  display: none;
		}

		input:checked ~ .checkmark:after {
		  display: block;

		}

		.checkmark:after {
		  left: 5px;
		  top: 5px;
		  width: 10px;
		  height: 10px;
		  border: solid black;
		  border-width: 2px ;
		  background-color: white;
  		  border-radius: 10px;
		}

		.label_container label {
			 position: relative;
			 display: inline-grid;
			 width: 25px;
			 height: 25px;
		}

		.label_container {
		 	display: grid;
			grid-template-columns: repeat(3, 1fr);
			border: 1px solid grey;
		}


	</style>

<script>	


// Canvas code
// get canvas related references
	var ctx1, canvas1,
		ctx2, canvas2,
		ctx3, canvas3,
		ctx4, canvas4,
		ctx5, canvas5,
		ctx6, canvas6,
		ctx7, canvas7,
		ctx8, canvas8;

		// binary object used to convert shapes and colors
	var binaryConvert = {
		Circle: "00",
		Square: "01",
		Triangle: "10",
		Star: "11",
		White: "000",
		Blue: "001",
		Yellow: "010",
		Green: "011",
		Orange: "100",
		Purple: "101",
		Red: "110",
		Black: "111",
	}


	// shape and color arrays
	var shapes = ["Circle","Square", "Triangle","Star"];
	var colors = ["Red","Blue", "Yellow","Green","Orange","Purple", "White","Black"];

	var currentPassword = [];

	$(document).ready(function(){

		// assign ctx and canvas to each of the 8 boxes
		canvas1=document.getElementById("canvas1");
		ctx1=canvas1.getContext("2d");

		canvas2=document.getElementById("canvas2");
		ctx2=canvas2.getContext("2d");

		canvas3=document.getElementById("canvas3");
		ctx3=canvas3.getContext("2d");

		canvas4=document.getElementById("canvas4");
		ctx4=canvas4.getContext("2d");

		canvas5=document.getElementById("canvas5");
		ctx5=canvas5.getContext("2d");

		canvas6=document.getElementById("canvas6");
		ctx6=canvas6.getContext("2d");

		canvas7=document.getElementById("canvas7");
		ctx7=canvas7.getContext("2d");

		canvas8=document.getElementById("canvas8");


		// iterate through 5-8 radio buttons and assign event listeners to them so that on change, they update the shapes and colors for the corresponding canvas and boxes
		for (let i=5;9>i;i++){

			$('input[type=radio][name=shape'+i+']').change(function() {
				let canvasD = document.getElementById("canvas"+i);
				let ctxD=canvasD.getContext("2d");
				clear(ctxD);

				var shape = $(this).parent().text();
				var fillStyle = $('input[type=radio][name=colors'+i+']:checked').val();
				console.log('fillstyleinside', fillStyle);


				if (fillStyle){
					rect(shape, ctxD,fillStyle);
					currentPassword[i-5] = {
						color: fillStyle,
						shape: shape
					}

				} else {
					rect(shape, ctxD,"White");
					currentPassword[i-5] = {
						color: "White",
						shape: shape
					}

				}

			});

			$('input[type=radio][name=colors'+i+']').change(function() {
				let canvasD = document.getElementById("canvas"+i);
				let ctxD=canvasD.getContext("2d");
				var shape = $('input[type=radio][name=shape'+i+']:checked').parent().text();
				ctxD.fillStyle = $(this).val();
		    	ctxD.fill();
				currentPassword[i-5].color = $(this).val()
				

			});

		}

	});

	//delate all shapes
	function clearShapes(){
		ctx5.clearRect(0, 0, 100, 100);

		ctx6.clearRect(0, 0, 100, 100);

		ctx7.clearRect(0, 0, 100, 100);

		ctx8.clearRect(0, 0, 100, 100);

	}

	// draw a single rect, changing what is drawn based on s, a string
	function rect(s,ctx,fillStyle) {

		x=15;
		y=15;
		w=50;
		ctx.fillStyle=fillStyle;
		console.log('ctx check', ctx,s,fillStyle);
	    if(s=="Square"){
	    	h=45;
			ctx.beginPath();
	    	ctx.rect(x,y,w,h);
	    	ctx.closePath();
	    	ctx.fill();
	    	ctx.stroke();

		}else if(s=="Circle"){
			x=10;
			y=10;
			w=55;
			ctx.beginPath();
			ctx.arc(x + 30, y + 30, w - 30, 0, 2 * Math.PI);
			ctx.fill();
			ctx.stroke();
		}else if(s=="Triangle"){
			h=40;
			ctx.beginPath();
		    ctx.moveTo(x + w/2, y);
		    ctx.lineTo(x, y + h);
		    ctx.lineTo(x + w, y + h);
		    ctx.closePath();
		    ctx.fill();
	    	ctx.stroke();

		}else if(s=="Star"){
			drawStar(40,40,5,30,15,ctx,fillStyle);
		}



	}


	function drawStar(cx,cy,spikes,outerRadius,innerRadius,ctx,fillStyle){
      var rot=Math.PI/2*3;
      var x=cx;
      var y=cy;
      var step=Math.PI/spikes;

      ctx.beginPath();
      for(i=0;i<spikes;i++){
        x=cx+Math.cos(rot)*outerRadius;
        y=cy+Math.sin(rot)*outerRadius;
        ctx.lineTo(x,y)
        rot+=step

        x=cx+Math.cos(rot)*innerRadius;
        y=cy+Math.sin(rot)*innerRadius;
        ctx.lineTo(x,y)
        rot+=step
      }
      ctx.lineTo(cx,cy-outerRadius);
      ctx.closePath();
      ctx.lineWidth=1;
      ctx.strokeStyle='Black';
      ctx.stroke();
      ctx.fillStyle=fillStyle;
      ctx.fill();
    }


	// clear the canvas
	function clear(ctx) {
		ctx.clearRect(0, 0, 100, 100);
	}

// End canvas code

var getUrlParameter = function getUrlParameter(sParam) {
    var sPageURL = decodeURIComponent(window.location.search.substring(1)),
        sURLVariables = sPageURL.split('&'),
sParameterName,
        i;

    for (i = 0; i < sURLVariables.length; i++) {
        sParameterName = sURLVariables[i].split('=');

		    if (sParameterName[0] === sParam) {
            return sParameterName[1] === undefined ? true : sParameterName[1];
		    }
    }
};

// create password
function createPassword(){

	var passwordString = "";

	// iterate through first 4 in create password and randomly assign a shape and color to each one
	for (var i=0;4>i;i++){
		var randomNumShape = Math.floor(Math.random() * 4);
		var randomShape = shapes[randomNumShape];
		var binaryShape = binaryConvert[randomShape];

		var randomNumColor = Math.floor(Math.random() * 8);
		var randomColor = colors[randomNumColor];

		var binaryColor = binaryConvert[randomColor];

		let canvasD = document.getElementById("canvas"+(i+1));
		let ctxD=canvasD.getContext("2d");
		rect(shapes[randomNumShape], ctxD,colors[randomNumColor]);

		passwordString += binaryShape + binaryColor;
	}


	return passwordString;
}


var passwordAccept = false;
var password = "";
var eventType = "";
// password creation

$(document).ready(function(){

	// get create, enter, and type parameters
	var create = getUrlParameter("create");
	var enter = getUrlParameter("enter");
	var type = getUrlParameter("type");

	var checkPassword = opener.document.getElementById("c"+type).getAttribute('data-password');

	if (create === "true"){

		// CREATE PASSWORD
		password = createPassword();
		$('#enterform').remove();

	} else if (enter === "true"){
		password = checkPassword;

		$('#createform').remove();
		$('#enterform').show();
	} else {
		alert ("no variable detected!");
	}



	$("input[name='realPassword'").val(password);

});

function enterPassword(type){


	var passwordString = "";

	for (var i=0;currentPassword.length>i;i++){
		var binaryShape = binaryConvert[currentPassword[i].shape];

		var binaryColor = binaryConvert[currentPassword[i].color];

		passwordString += binaryShape + binaryColor;
	}


	if (type == 'Test'){
		if (passwordString === password){
			alert("You entered password correctly!");
		} else {
			alert("Sorry you made a mistake!");
		}
	} else {
		if (passwordString === password){
			alert("You entered password correctly!");
			eventType = "success";


		} else {
			alert("Sorry you made a mistake!");
			eventType = "failure";
		}

		passwordAccept = true;
		window.close();

	}

}


function togPassword() {

    $("input[name='realPassword'").toggle();
    $("#shapePassword").toggle();
}

function acceptPassword(){
	passwordAccept = true;
	window.close();
}

</script>
<body>


  <div id="createform" style="display: block;">
    <form id="createcontrol">
      Your password is: 
      <input type="text" name="realPassword" value="" readonly="" readsize="42" style="border-style:none;font-size:14pt;font-family:monospace;font-weight:bold; "><br>

      <!-- This is the creation password blocks -->
	<div id="shapePassword">
		<canvas id="canvas1" width=75 height=75></canvas>
		<canvas id="canvas2" width=75 height=75></canvas>

		<canvas id="canvas3" width=75 height=75></canvas>

		<canvas id="canvas4" width=75 height=75></canvas>
	</div>


      Check the box to make your real password hidden or shown.
      <input type="checkbox" name="check" checked="" onclick="togPassword()"><br>
      
      Please practice your password now:


	<!-- This is the input password blocks for the creation screen-->
  	<div>
		<canvas id="canvas5" width=75 height=75></canvas>
		<canvas id="canvas6" width=75 height=75></canvas>

		<canvas id="canvas7" width=75 height=75></canvas>

		<canvas id="canvas8" width=75 height=75></canvas>
	</div>
	<div style="width:75px;float:left">
		<label for='circle5'><input type="radio" name="shape5" id="circle5">Circle</span></label><br>
		<label for='square5'><input type="radio" name="shape5" id="square5">Square</label><br>
		<label for='triangle5'><input type="radio" name="shape5" id="triangle5">Triangle</label><br>
		<label for='star5'><input type="radio" name="shape5" id="star5">Star</label><br>
		<hr>
		<div class ="label_container">
			<label for='red5'><input type="radio" name="colors5" id="red5" value="Red"><span style=" background-color: red;" class="checkmark"></label>
			<label for='blue5'><input type="radio" name="colors5" id="blue5" value="Blue" ><span style=" background-color: blue;" class="checkmark"></label>
			<label for='yellow5'><input type="radio" name="colors5" id="yellow5" value="Yellow"><span style=" background-color: yellow;" class="checkmark"></label>
			<label for='green5'><input type="radio" name="colors5" id="green5" value="Green"><span style=" background-color: green;" class="checkmark"></label>
			<label for='orange5'><input type="radio" name="colors5" id="orange5" value="Orange"><span style=" background-color: orange;" class="checkmark"></label>
			<label for='purple5'><input type="radio" name="colors5" id="purple5" value="Purple"><span  style=" background-color: purple;" class="checkmark"></label>
			<label for='white5'><input type="radio" name="colors5" id="white5" value="White"><span style=" background-color: white;" class="checkmark"></label>
			<label for='black5'><input type="radio" name="colors5" id="black5" value="Black"><span style=" background-color: black;" class="checkmark"></label>
		</div>
	</div>
	<div style="width:75px;float:left">
		<label for='circle6'><input type="radio" name="shape6" id="circle6">Circle</label><br>
		<label for='square6'><input type="radio" name="shape6" id="square6">Square</label><br>
		<label for='triangle6'><input type="radio" name="shape6" id="triangle6">Triangle</label><br>
		<label for='star6'><input type="radio" name="shape6" id="star6">Star</label><br>
		<hr>
		<div class ="label_container">
			<label for='red6'><input type="radio" name="colors6" id="red6" value="Red"><span style=" background-color: red;" class="checkmark"></label>
			<label for='blue6'><input type="radio" name="colors6" id="blue6" value="Blue" ><span style=" background-color: blue;" class="checkmark"></label>
			<label for='yellow6'><input type="radio" name="colors6" id="yellow6" value="Yellow"><span style=" background-color: yellow;" class="checkmark"></label>
			<label for='green6'><input type="radio" name="colors6" id="green6" value="Green"><span style=" background-color: green;" class="checkmark"></label>
			<label for='orange6'><input type="radio" name="colors6" id="orange6" value="Orange"><span style=" background-color: orange;" class="checkmark"></label>
			<label for='purple6'><input type="radio" name="colors6" id="purple6" value="Purple"><span  style=" background-color: purple;" class="checkmark"></label>
			<label for='white6'><input type="radio" name="colors6" id="white6" value="White"><span style=" background-color: white;" class="checkmark"></label>
			<label for='black6'><input type="radio" name="colors6" id="black6" value="Black"><span style=" background-color: black;" class="checkmark"></label>
		</div>
	</div>
	<div style="width:75px;float:left">
		<label for='circle7'><input type="radio" name="shape7" id="circle7">Circle</label><br>
		<label for='square7'><input type="radio" name="shape7" id="square7">Square</label><br>
		<label for='triangle7'><input type="radio" name="shape7" id="triangle7">Triangle</label><br>
		<label for='star7'><input type="radio" name="shape7" id="star7">Star</label><br>
		<hr>
		<div class ="label_container">
			<label for='red7'><input type="radio" name="colors7" id="red7" value="Red"><span style=" background-color: red;" class="checkmark"></label>
			<label for='blue7'><input type="radio" name="colors7" id="blue7" value="Blue" ><span style=" background-color: blue;" class="checkmark"></label>
			<label for='yellow7'><input type="radio" name="colors7" id="yellow7" value="Yellow"><span style=" background-color: yellow;" class="checkmark"></label>
			<label for='green7'><input type="radio" name="colors7" id="green7" value="Green"><span style=" background-color: green;" class="checkmark"></label>
			<label for='orange7'><input type="radio" name="colors7" id="orange7" value="Orange"><span style=" background-color: orange;" class="checkmark"></label>
			<label for='purple7'><input type="radio" name="colors7" id="purple7" value="Purple"><span  style=" background-color: purple;" class="checkmark"></label>
			<label for='white7'><input type="radio" name="colors7" id="white7" value="White"><span style=" background-color: white;" class="checkmark"></label>
			<label for='black7'><input type="radio" name="colors7" id="black7" value="Black"><span style=" background-color: black;" class="checkmark"></label>
		</div>
	</div>
		<div style="width:75px;float:left">
		<label for='circle8'><input type="radio" name="shape8" id="circle8">Circle</label><br>
		<label for='square8'><input type="radio" name="shape8" id="square8">Square</label><br>
		<label for='triangle8'><input type="radio" name="shape8" id="triangle8">Triangle</label><br>
		<label for='star8'><input type="radio" name="shape8" id="star8">Star</label><br>
		<hr>
		<div class ="label_container">
			<label for='red8'><input type="radio" name="colors8" id="red8" value="Red"><span style=" background-color: red;" class="checkmark"></label>
			<label for='blue8'><input type="radio" name="colors8" id="blue8" value="Blue" ><span style=" background-color: blue;" class="checkmark"></label>
			<label for='yellow8'><input type="radio" name="colors8" id="yellow8" value="Yellow"><span style=" background-color: yellow;" class="checkmark"></label>
			<label for='green8'><input type="radio" name="colors8" id="green8" value="Green"><span style=" background-color: green;" class="checkmark"></label>
			<label for='orange8'><input type="radio" name="colors8" id="orange8" value="Orange"><span style=" background-color: orange;" class="checkmark"></label>
			<label for='purple8'><input type="radio" name="colors8" id="purple8" value="Purple"><span  style=" background-color: purple;" class="checkmark"></label>
			<label for='white8'><input type="radio" name="colors8" id="white8" value="White"><span style=" background-color: white;" class="checkmark"></label>
			<label for='black8'><input type="radio" name="colors8" id="black8" value="Black"><span style=" background-color: black;" class="checkmark"></label>
		</div>
	</div>
	<br style="clear:both">
      <input type="button" value="Test" onclick="enterPassword('Test')"><br>
      <input type="button" value="Clear" onclick="clearShapes()"><br>

      When you're finished practicing, click accept. <br>
      <input type="button" value="Accept Password" onclick="acceptPassword()">
    </form>
  </div>



  <!-- This is the enter form section, will not be shown and will be removed if parameter not there -->
  <div id="enterform" style="display:none">
    <form id="entercontrol">
      Password:


      	<!-- This is the input password blocks but for when you are entering -->

  	<div>
		<canvas id="canvas5" width=75 height=75></canvas>
		<canvas id="canvas6" width=75 height=75></canvas>
		<canvas id="canvas7" width=75 height=75></canvas>
		<canvas id="canvas8" width=75 height=75></canvas>
	</div>
<div style="width:75px;float:left">
		<label for='circle5'><input type="radio" name="shape5" id="circle5">Circle</span></label><br>
		<label for='square5'><input type="radio" name="shape5" id="square5">Square</label><br>
		<label for='triangle5'><input type="radio" name="shape5" id="triangle5">Triangle</label><br>
		<label for='star5'><input type="radio" name="shape5" id="star5">Star</label><br>
		<hr>
		<div class ="label_container">
			<label for='red5'><input type="radio" name="colors5" id="red5" value="Red"><span style=" background-color: red;" class="checkmark"></label>
			<label for='blue5'><input type="radio" name="colors5" id="blue5" value="Blue" ><span style=" background-color: blue;" class="checkmark"></label>
			<label for='yellow5'><input type="radio" name="colors5" id="yellow5" value="Yellow"><span style=" background-color: yellow;" class="checkmark"></label>
			<label for='green5'><input type="radio" name="colors5" id="green5" value="Green"><span style=" background-color: green;" class="checkmark"></label>
			<label for='orange5'><input type="radio" name="colors5" id="orange5" value="Orange"><span style=" background-color: orange;" class="checkmark"></label>
			<label for='purple5'><input type="radio" name="colors5" id="purple5" value="Purple"><span  style=" background-color: purple;" class="checkmark"></label>
			<label for='white5'><input type="radio" name="colors5" id="white5" value="White"><span style=" background-color: white;" class="checkmark"></label>
			<label for='black5'><input type="radio" name="colors5" id="black5" value="Black"><span style=" background-color: black;" class="checkmark"></label>
		</div>
	</div>
	<div style="width:75px;float:left">
		<label for='circle6'><input type="radio" name="shape6" id="circle6">Circle</label><br>
		<label for='square6'><input type="radio" name="shape6" id="square6">Square</label><br>
		<label for='triangle6'><input type="radio" name="shape6" id="triangle6">Triangle</label><br>
		<label for='star6'><input type="radio" name="shape6" id="star6">Star</label><br>
		<hr>
		<div class ="label_container">
			<label for='red6'><input type="radio" name="colors6" id="red6" value="Red"><span style=" background-color: red;" class="checkmark"></label>
			<label for='blue6'><input type="radio" name="colors6" id="blue6" value="Blue" ><span style=" background-color: blue;" class="checkmark"></label>
			<label for='yellow6'><input type="radio" name="colors6" id="yellow6" value="Yellow"><span style=" background-color: yellow;" class="checkmark"></label>
			<label for='green6'><input type="radio" name="colors6" id="green6" value="Green"><span style=" background-color: green;" class="checkmark"></label>
			<label for='orange6'><input type="radio" name="colors6" id="orange6" value="Orange"><span style=" background-color: orange;" class="checkmark"></label>
			<label for='purple6'><input type="radio" name="colors6" id="purple6" value="Purple"><span  style=" background-color: purple;" class="checkmark"></label>
			<label for='white6'><input type="radio" name="colors6" id="white6" value="White"><span style=" background-color: white;" class="checkmark"></label>
			<label for='black6'><input type="radio" name="colors6" id="black6" value="Black"><span style=" background-color: black;" class="checkmark"></label>
		</div>
	</div>
	<div style="width:75px;float:left">
		<label for='circle7'><input type="radio" name="shape7" id="circle7">Circle</label><br>
		<label for='square7'><input type="radio" name="shape7" id="square7">Square</label><br>
		<label for='triangle7'><input type="radio" name="shape7" id="triangle7">Triangle</label><br>
		<label for='star7'><input type="radio" name="shape7" id="star7">Star</label><br>
		<hr>
		<div class ="label_container">
			<label for='red7'><input type="radio" name="colors7" id="red7" value="Red"><span style=" background-color: red;" class="checkmark"></label>
			<label for='blue7'><input type="radio" name="colors7" id="blue7" value="Blue" ><span style=" background-color: blue;" class="checkmark"></label>
			<label for='yellow7'><input type="radio" name="colors7" id="yellow7" value="Yellow"><span style=" background-color: yellow;" class="checkmark"></label>
			<label for='green7'><input type="radio" name="colors7" id="green7" value="Green"><span style=" background-color: green;" class="checkmark"></label>
			<label for='orange7'><input type="radio" name="colors7" id="orange7" value="Orange"><span style=" background-color: orange;" class="checkmark"></label>
			<label for='purple7'><input type="radio" name="colors7" id="purple7" value="Purple"><span  style=" background-color: purple;" class="checkmark"></label>
			<label for='white7'><input type="radio" name="colors7" id="white7" value="White"><span style=" background-color: white;" class="checkmark"></label>
			<label for='black7'><input type="radio" name="colors7" id="black7" value="Black"><span style=" background-color: black;" class="checkmark"></label>
		</div>
	</div>
		<div style="width:75px;float:left">
		<label for='circle8'><input type="radio" name="shape8" id="circle8">Circle</label><br>
		<label for='square8'><input type="radio" name="shape8" id="square8">Square</label><br>
		<label for='triangle8'><input type="radio" name="shape8" id="triangle8">Triangle</label><br>
		<label for='star8'><input type="radio" name="shape8" id="star8">Star</label><br>
		<hr>
		<div class ="label_container">
			<label for='red8'><input type="radio" name="colors8" id="red8" value="Red"><span style=" background-color: red;" class="checkmark"></label>
			<label for='blue8'><input type="radio" name="colors8" id="blue8" value="Blue" ><span style=" background-color: blue;" class="checkmark"></label>
			<label for='yellow8'><input type="radio" name="colors8" id="yellow8" value="Yellow"><span style=" background-color: yellow;" class="checkmark"></label>
			<label for='green8'><input type="radio" name="colors8" id="green8" value="Green"><span style=" background-color: green;" class="checkmark"></label>
			<label for='orange8'><input type="radio" name="colors8" id="orange8" value="Orange"><span style=" background-color: orange;" class="checkmark"></label>
			<label for='purple8'><input type="radio" name="colors8" id="purple8" value="Purple"><span  style=" background-color: purple;" class="checkmark"></label>
			<label for='white8'><input type="radio" name="colors8" id="white8" value="White"><span style=" background-color: white;" class="checkmark"></label>
			<label for='black8'><input type="radio" name="colors8" id="black8" value="Black"><span style=" background-color: black;" class="checkmark"></label>
		</div>
	</div>	<br style="clear:both">
      <input type="button" value="Done" onclick="enterPassword()"><br>
    	<input type="button" value="Clear" onclick="clearShapes()"><br>

      <p>
    </p></form>
  </div>
  

</body>


</head>

</html>